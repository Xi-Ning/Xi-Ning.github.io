(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{327:function(s,t,a){s.exports=a.p+"assets/img/EDO-B01-01.5439fde9.jpg"},328:function(s,t,a){s.exports=a.p+"assets/img/EDO-B01-02.04f77395.jpg"},366:function(s,t,a){"use strict";a.r(t);var e=a(33),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"_1-exp-导出空表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-exp-导出空表"}},[s._v("#")]),s._v(" 1 exp 导出空表")]),s._v(" "),e("Seal",{attrs:{title:"exp 导出空表",createDate:"2021.03.31"}}),s._v(" "),e("h2",{attrs:{id:"_1-1-问题分析与解决方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-问题分析与解决方法"}},[s._v("#")]),s._v(" 1.1 问题分析与解决方法")]),s._v(" "),e("p",[s._v("问题描述：Oracle 11g及以后的版本，在导出数据库时，会自动过滤掉空表。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(327),alt:""}})]),s._v(" "),e("p",[s._v("原因：Oracle出于节省空间的考虑，默认对空表不分配segment。")]),s._v(" "),e("p",[s._v("解决方法：手工为空表分配extent。")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" table_name allocate extent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("关于segment、extent和block")]),s._v(" "),e("p",[s._v("segment（段）、extent（区）、block（块）都是Oracle存储的物理概念名称。")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("block是Oracle存储的最基本单位，由db_block_size指定，通常为8KB，由连续的sector（磁盘的最小存储单位，512byte）组成")])]),s._v(" "),e("li",[e("p",[s._v("连续的数据块block组成一个分区extent，便于空间管理，包括空间的分配和释放")])]),s._v(" "),e("li",[e("p",[s._v("segment段的由extent区组成，但不要求连续")])])])]),s._v(" "),e("h2",{attrs:{id:"_1-2-批量处理空表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-批量处理空表"}},[s._v("#")]),s._v(" 1.2 批量处理空表")]),s._v(" "),e("p",[s._v("通过以下语句，可以查询到当前用户下的所有空表：")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" table_name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" user_tables "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" num_rows "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" num_rows "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("进而可以为所有空表批量生成分配extent的语句：")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alter table '")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" table_name "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("' allocate extent;'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" user_tables "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" num_rows "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" num_rows "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:a(328),alt:""}})]),s._v(" "),e("p",[s._v("将结果集导出并执行即可。")]),s._v(" "),e("h2",{attrs:{id:"_1-3-脚本工具的编写与使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-脚本工具的编写与使用"}},[s._v("#")]),s._v(" 1.3 脚本工具的编写与使用")]),s._v(" "),e("p",[s._v("（1）创建一个本地脚本文件init.sql，内容如下：")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" heading "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("off")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" echo "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("off")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" feedback "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("off")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" termout "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nspool d:\\allocate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alter table '")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" table_name "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("' allocate extent;'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" user_tables "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" num_rows "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" num_rows "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nspool "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("off")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("（2）通过plsql developer的命令窗口，执行init.sql脚本文件，得到分配extent的脚本allocate.sql：")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SQL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@d")]),s._v(":\\init"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("（3）再执行所生成的allocate.sql脚本文件，完成空表分配extent：")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SQL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@d")]),s._v(":\\allocate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])],1)}),[],!1,null,null,null);t.default=r.exports}}]);