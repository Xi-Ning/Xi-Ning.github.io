<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3 Lambda表达式 | 熙宁的笔记</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="熙宁的笔记">
    <link rel="preload" href="/assets/css/0.styles.a214eddf.css" as="style"><link rel="preload" href="/assets/js/app.cb1c172b.js" as="script"><link rel="preload" href="/assets/js/2.167078e5.js" as="script"><link rel="preload" href="/assets/js/11.037eebc3.js" as="script"><link rel="preload" href="/assets/js/7.9c9ec0c0.js" as="script"><link rel="prefetch" href="/assets/js/10.0f582f33.js"><link rel="prefetch" href="/assets/js/12.8f17b146.js"><link rel="prefetch" href="/assets/js/13.4a8752c4.js"><link rel="prefetch" href="/assets/js/14.ba253d45.js"><link rel="prefetch" href="/assets/js/15.3ed11aef.js"><link rel="prefetch" href="/assets/js/16.bb7d381c.js"><link rel="prefetch" href="/assets/js/17.23d55241.js"><link rel="prefetch" href="/assets/js/18.d2d48b45.js"><link rel="prefetch" href="/assets/js/19.4b89e615.js"><link rel="prefetch" href="/assets/js/20.6849e7d8.js"><link rel="prefetch" href="/assets/js/21.9354a1f9.js"><link rel="prefetch" href="/assets/js/22.b8756be9.js"><link rel="prefetch" href="/assets/js/23.dd40b66d.js"><link rel="prefetch" href="/assets/js/24.385a365c.js"><link rel="prefetch" href="/assets/js/25.4bedcffd.js"><link rel="prefetch" href="/assets/js/26.4fc2fdc7.js"><link rel="prefetch" href="/assets/js/27.7545329b.js"><link rel="prefetch" href="/assets/js/28.698a72f8.js"><link rel="prefetch" href="/assets/js/29.e18b0152.js"><link rel="prefetch" href="/assets/js/3.2449b7eb.js"><link rel="prefetch" href="/assets/js/30.7feecae2.js"><link rel="prefetch" href="/assets/js/31.19020bf9.js"><link rel="prefetch" href="/assets/js/32.59c08869.js"><link rel="prefetch" href="/assets/js/33.1d711235.js"><link rel="prefetch" href="/assets/js/34.935bf144.js"><link rel="prefetch" href="/assets/js/35.919dc5c0.js"><link rel="prefetch" href="/assets/js/36.a24dd771.js"><link rel="prefetch" href="/assets/js/37.319a3c09.js"><link rel="prefetch" href="/assets/js/38.d5f3d7d2.js"><link rel="prefetch" href="/assets/js/39.74903431.js"><link rel="prefetch" href="/assets/js/4.82b9e3a3.js"><link rel="prefetch" href="/assets/js/40.5f82bef6.js"><link rel="prefetch" href="/assets/js/41.7618f134.js"><link rel="prefetch" href="/assets/js/42.20e95b2f.js"><link rel="prefetch" href="/assets/js/5.5ddd79a9.js"><link rel="prefetch" href="/assets/js/6.2622a0f7.js"><link rel="prefetch" href="/assets/js/8.b1d96fa7.js"><link rel="prefetch" href="/assets/js/9.1a1de1ce.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a214eddf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo128.png" alt="熙宁的笔记" class="logo"> <span class="site-name can-hide">熙宁的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语法区" class="dropdown-title"><span class="title">语法区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ★ 数据库 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/devlang/db/oracle/grammar/DDO-G01-start_with.html" class="nav-link">
  Oracle
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="扫盲区" class="dropdown-title"><span class="title">扫盲区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/concept/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/concept/network/" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实践区" class="dropdown-title"><span class="title">实践区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ★ 综合复盘 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/project/EP-001-high_concurrency.html" class="nav-link">
  某高并发互联网项目
</a></li></ul></li><li class="dropdown-item"><h4>
          ★ 数据库 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/db/oracle/basic/EDO-B01-exp_empty.html" class="nav-link">
  Oracle
</a></li></ul></li><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/css/solution/EC-S01-collapse_chrome.html" class="nav-link">
  CSS
</a></li></ul></li><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/other/" class="nav-link">
  其它
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专项区" class="dropdown-title"><span class="title">专项区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/special/java8_in_action/SJIA-001-why_java8.html" class="nav-link">
  Java 8 实战
</a></li><li class="dropdown-item"><!----> <a href="/special/effective_java/SEJ-001-create_destroy_objects.html" class="nav-link">
  Effective Java 第2版
</a></li></ul></div></div><div class="nav-item"><a href="/readingnotes/" class="nav-link">
  阅读区
</a></div><div class="nav-item"><a href="/wordlist/" class="nav-link">
  单词表
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语法区" class="dropdown-title"><span class="title">语法区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ★ 数据库 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/devlang/db/oracle/grammar/DDO-G01-start_with.html" class="nav-link">
  Oracle
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="扫盲区" class="dropdown-title"><span class="title">扫盲区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/concept/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/concept/network/" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实践区" class="dropdown-title"><span class="title">实践区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ★ 综合复盘 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/project/EP-001-high_concurrency.html" class="nav-link">
  某高并发互联网项目
</a></li></ul></li><li class="dropdown-item"><h4>
          ★ 数据库 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/db/oracle/basic/EDO-B01-exp_empty.html" class="nav-link">
  Oracle
</a></li></ul></li><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/css/solution/EC-S01-collapse_chrome.html" class="nav-link">
  CSS
</a></li></ul></li><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/other/" class="nav-link">
  其它
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专项区" class="dropdown-title"><span class="title">专项区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/special/java8_in_action/SJIA-001-why_java8.html" class="nav-link">
  Java 8 实战
</a></li><li class="dropdown-item"><!----> <a href="/special/effective_java/SEJ-001-create_destroy_objects.html" class="nav-link">
  Effective Java 第2版
</a></li></ul></div></div><div class="nav-item"><a href="/readingnotes/" class="nav-link">
  阅读区
</a></div><div class="nav-item"><a href="/wordlist/" class="nav-link">
  单词表
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java 8 实战</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/special/java8_in_action/SJIA-001-why_java8.html" class="sidebar-link">1 为什么要关心Java 8</a></li><li><a href="/special/java8_in_action/SJIA-002-behavior_parameterization.html" class="sidebar-link">2 通过行为参数化传递代码</a></li><li><a href="/special/java8_in_action/SJIA-003-lambda.html" class="active sidebar-link">3 Lambda表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-1-初识lambda" class="sidebar-link">3.1 初识Lambda</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-2-lambda的应用场景" class="sidebar-link">3.2 Lambda的应用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-2-1-函数式接口" class="sidebar-link">3.2.1 函数式接口</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-2-2-函数描述符" class="sidebar-link">3.2.2 函数描述符</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-2-3-环绕执行模式" class="sidebar-link">3.2.3 环绕执行模式</a></li></ul></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-3-函数式接口" class="sidebar-link">3.3 函数式接口</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-3-1-原始类型特化" class="sidebar-link">3.3.1 原始类型特化</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-3-2-常用函数式接口" class="sidebar-link">3.3.2 常用函数式接口</a></li></ul></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-4-lambda的类型" class="sidebar-link">3.4 Lambda的类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-4-1-目标类型" class="sidebar-link">3.4.1 目标类型</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-4-2-类型检查" class="sidebar-link">3.4.2 类型检查</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-4-3-参数类型推断" class="sidebar-link">3.4.3 参数类型推断</a></li></ul></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-5-使用局部变量" class="sidebar-link">3.5 使用局部变量</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-6-方法引用" class="sidebar-link">3.6 方法引用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-6-1-什么是方法引用" class="sidebar-link">3.6.1 什么是方法引用</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-6-2-基本语法" class="sidebar-link">3.6.2 基本语法</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-6-3-方法引用的分类" class="sidebar-link">3.6.3 方法引用的分类</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-6-4-构造函数引用" class="sidebar-link">3.6.4 构造函数引用</a></li></ul></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-7-综合实例" class="sidebar-link">3.7 综合实例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-7-1-传递代码" class="sidebar-link">3.7.1 传递代码</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-7-2-使用匿名类" class="sidebar-link">3.7.2 使用匿名类</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-7-3-使用lambda表达式" class="sidebar-link">3.7.3 使用Lambda表达式</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-7-4-使用方法引用" class="sidebar-link">3.7.4 使用方法引用</a></li></ul></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-8-复合lambda表达式的方法" class="sidebar-link">3.8 复合Lambda表达式的方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-8-1-比较器复合" class="sidebar-link">3.8.1 比较器复合</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-8-2-谓词复合" class="sidebar-link">3.8.2 谓词复合</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-003-lambda.html#_3-8-3-函数复合" class="sidebar-link">3.8.3 函数复合</a></li></ul></li></ul></li><li><a href="/special/java8_in_action/SJIA-004-stream.html" class="sidebar-link">4 引入流</a></li><li><a href="/special/java8_in_action/SJIA-005-use_stream.html" class="sidebar-link">5 使用流</a></li><li><a href="/special/java8_in_action/SJIA-006-collectors.html" class="sidebar-link">6 用流收集数据</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_3-lambda表达式"><a href="#_3-lambda表达式" class="header-anchor">#</a> 3 Lambda表达式</h1> <div class="seal-box" data-v-77f8f7a4><div data-v-77f8f7a4><!----> <div class="head" data-v-77f8f7a4>读书笔记</div> <div data-v-77f8f7a4><span class="ico ico-book" data-v-77f8f7a4>  书   名  ： Java 8 实战</span></div> <div data-v-77f8f7a4><span class="ico ico-author" data-v-77f8f7a4>  作   者  ： （英）Raoul-Gabriel Urma（意）Mario Fusco（英）Alan Myscroft</span></div> <div data-v-77f8f7a4><span class="ico ico-translator" data-v-77f8f7a4>  译   者  ： 陆明刚，劳佳</span></div> <div data-v-77f8f7a4><span class="ico ico-publisher" data-v-77f8f7a4> 出 版 社 ： 人民邮电出版社</span></div> <div data-v-77f8f7a4><span class="ico ico-calendar" data-v-77f8f7a4>出版时间： 2016.04</span></div> <div data-v-77f8f7a4><span class="ico ico-date" data-v-77f8f7a4>创建时间：</span> <span class="info" data-v-77f8f7a4>2021.12.01</span></div> <div data-v-77f8f7a4><span class="ico ico-refresh" data-v-77f8f7a4>最后更新：</span> <span class="info" data-v-77f8f7a4>2021.12.07</span></div> <!----> <!----> <!----> <div class="foot" data-v-77f8f7a4>竢实扬华 · 自强不息</div></div></div> <h2 id="_3-1-初识lambda"><a href="#_3-1-初识lambda" class="header-anchor">#</a> 3.1 初识Lambda</h2> <p>可以把Lambda表达式理解为简洁地表示可传递的匿名函数的一种方式：它没有名称，但它有参数列表、函数主体、返回类型，可能还有一个可以抛出的异常列表。</p> <div class="custom-block tip"><p class="custom-block-title">Lambda起源</p> <p>Lambda来自于学术界开发出来的一套用来描述计算的λ演算法。</p></div> <p>Lambda表达式的三个组成部分：</p> <ul><li><p>参数列表</p></li> <li><p>箭头 <code>-&gt;</code> 用来将参数列表与Lambda主体分隔开</p></li> <li><p>Lambda主体</p></li></ul> <p>基本语法如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Lambda主体是单独的一条表达式，此时没有return语句，已经隐含了return语句</span>
<span class="token punctuation">(</span>parameters<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> expression

<span class="token comment">// Lambda主体包含多行语句，需要使用花括号</span>
<span class="token punctuation">(</span>parameters<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> statements<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Lambda举例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a <span class="token operator">*</span> b

<span class="token punctuation">(</span><span class="token class-name">Apple</span> a<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="_3-2-lambda的应用场景"><a href="#_3-2-lambda的应用场景" class="header-anchor">#</a> 3.2 Lambda的应用场景</h2> <h3 id="_3-2-1-函数式接口"><a href="#_3-2-1-函数式接口" class="header-anchor">#</a> 3.2.1 函数式接口</h3> <p>函数式接口就是只定义一个抽象方法的接口。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>接口可以拥有默认方法，一个接口哪怕有很多默认方法，只要其只定义了一个抽象方法，那么它就仍然是一个函数式接口。</p></div> <p>Lambda表达式允许直接以内联的形式为函数式接口的抽象方法提供实现，并把整个表达式作为函数式接口的实例。（使用匿名类可以完成同样的事情，但比较笨拙。）</p> <blockquote><p>只有在接受函数式接口的地方才可以使用Lambda表达式</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 使用Lambda，Lambda可以被赋给一个变量</span>
<span class="token class-name">Runnable</span> r1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用匿名类</span>
<span class="token class-name">Runnable</span> r2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">process</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">process</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Lambda可以直接传递给函数式接口作为参数</span>
<span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">@FunctionalInterface</p> <p><code>@FunctionalInterface</code>注解表示接口会设计成一个函数式接口。</p> <p>虽然它不是必须的，但对设计来讲使用它是好的做法，就像是<code>@Override</code>。</p></div> <h3 id="_3-2-2-函数描述符"><a href="#_3-2-2-函数描述符" class="header-anchor">#</a> 3.2.2 函数描述符</h3> <p>函数式接口的抽象式方法的签名，或Lambda表达式的签名，可以称作函数描述符，如：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">T</span>
<span class="token class-name">T</span> <span class="token operator">-&gt;</span> <span class="token class-name">T</span>
<span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">void</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-2-3-环绕执行模式"><a href="#_3-2-3-环绕执行模式" class="header-anchor">#</a> 3.2.3 环绕执行模式</h3> <p>环绕执行模式，指有一些常规的、套路化的操作（如资源的分配与清理），会围绕着重要的处理代码。</p> <p>环绕执行模式可以配合Lambda提高灵活性和可重用性。</p> <h2 id="_3-3-函数式接口"><a href="#_3-3-函数式接口" class="header-anchor">#</a> 3.3 函数式接口</h2> <h3 id="_3-3-1-原始类型特化"><a href="#_3-3-1-原始类型特化" class="header-anchor">#</a> 3.3.1 原始类型特化</h3> <p>函数式接口的函数描述符中的泛型（如<code>Consumer&lt;T&gt;</code>中的<code>T</code>），只能绑定到引用类型。因此会有装箱（boxing）与拆箱（unboxing）的操作。</p> <p>但这些操作在性能方面是要付出代价的。装箱后的值本质上就是把原始类型包裹起来，并保存在堆里，装箱后的值需要更多的内存，还需要额外的内存搜索来获取被包裹的原始值。</p> <p>Java 8为函数式接口提供了专门的版本，以便在输入和输出是原始类型时避免自动装箱的操作。</p> <h3 id="_3-3-2-常用函数式接口"><a href="#_3-3-2-常用函数式接口" class="header-anchor">#</a> 3.3.2 常用函数式接口</h3> <table><thead><tr><th>函数式接口</th> <th>函数描述符</th> <th>原始类型特化</th></tr></thead> <tbody><tr><td>Predicate&lt;T&gt;</td> <td>T -&gt; boolean</td> <td>IntPredicate、LongPredicate、DoublePredicate</td></tr> <tr><td>Consumer&lt;T&gt;</td> <td>T -&gt; void</td> <td>IntConsumer、LongConsumer、DoubleConsumer</td></tr> <tr><td>Function&lt;T, R&gt;</td> <td>T -&gt; R</td> <td>IntFunction&lt;R&gt;、IntToDoubleFunction、IntToLongFunction、<br>LongFunction&lt;R&gt;、LongToDoubleFunction、LongToIntFunction、<br>DoubleFunction&lt;R&gt;、DoubleToLongFunction、DoubleToIntFunction、<br>ToIntFunction&lt;T&gt;、ToLongFunction&lt;T&gt;、ToDoubleFunction&lt;T&gt;</td></tr> <tr><td>Supplier&lt;T&gt;</td> <td>() -&gt; T</td> <td>BooleanSupplier、IntSupplier、LongSupplier、DoubleSupplier</td></tr> <tr><td>UnaryOperator&lt;T&gt;</td> <td>T -&gt; T</td> <td>IntUnaryOperator、LongUnaryOperator、DoubleUnaryOperator</td></tr> <tr><td>BinaryOperator&lt;T&gt;</td> <td>(T, T) -&gt; T</td> <td>IntBinaryOperator、LongBinaryOperator、DoubleBinaryOperator</td></tr> <tr><td>BiPredicate&lt;L, R&gt;</td> <td>(L, R) -&gt; boolean</td> <td></td></tr> <tr><td>BiConsumer&lt;T, U&gt;</td> <td>(T, U) -&gt; void</td> <td>ObjIntConsumer&lt;T&gt;、ObjLongConsumer&lt;T&gt;、ObjDoubleConsumer&lt;T&gt;</td></tr> <tr><td>BiFunction&lt;T, U, R&gt;</td> <td>(T, U) -&gt; R</td> <td>ToIntBiFunction&lt;T, U&gt;、ToLongBiFunction&lt;T, U&gt;、ToDoubleBiFunction&lt;T, U&gt;</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>unary 一元的</p> <p>binary 二元的</p></div> <h2 id="_3-4-lambda的类型"><a href="#_3-4-lambda的类型" class="header-anchor">#</a> 3.4 Lambda的类型</h2> <h3 id="_3-4-1-目标类型"><a href="#_3-4-1-目标类型" class="header-anchor">#</a> 3.4.1 目标类型</h3> <p>Lambda表达式为函数式接口生成了一个实例，但Lambda表达式本身并不包含它在实现哪个函数式接口的信息。</p> <p>Lambda的类型是从使用Lambda的上下文推断出来的，将上下文中Lambda表达式需要的类型称为目标类型。</p> <div class="custom-block tip"><p class="custom-block-title">上下文</p> <p>这里的上下文，可以是接受Lambda表达式传递的方法的参数，或是接受Lambda表达式的值的局部变量。</p></div> <h3 id="_3-4-2-类型检查"><a href="#_3-4-2-类型检查" class="header-anchor">#</a> 3.4.2 类型检查</h3> <p>类型检查的过程如下：</p> <p><img src="/assets/img/SJIA-003-01.32f94cc6.jpg" alt=""></p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>如果Lambda表达式抛出一个异常，那么抽象方法所声明的<code>throws</code>语句也必须与之匹配。</p></div> <div class="custom-block tip"><p class="custom-block-title">特殊的void兼容规则</p> <p>如果Lambda的主体是一个语句表达式，它就和一个返回void的函数描述符兼容。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Predicate返回boolean</span>
<span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> p <span class="token operator">=</span> s <span class="token operator">-&gt;</span> list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Consumer返回void</span>
<span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> b <span class="token operator">=</span> s <span class="token operator">-&gt;</span> list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <p>有了目标类型的概念，同一个Lambda表达式就可以与不同的函数式接口联系起来，只要它们的抽象方法签名能够兼容。</p> <div class="custom-block tip"><p class="custom-block-title">菱形运算符</p> <p>Java 7中引入了菱形运算符（<code>&lt;&gt;</code>），利用泛型推断、从上下文推断类型的思想，一个类实例表达式可以出现在两个或更多不同的上下文中，并会推断出适当的参数类型：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> listOfStrings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> listOfIntegers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <h3 id="_3-4-3-参数类型推断"><a href="#_3-4-3-参数类型推断" class="header-anchor">#</a> 3.4.3 参数类型推断</h3> <p>Java编译器能够从上下文（目标类型）中推断出适合的Lambda签名，也就有出了Lambda表达式的参数类型，这样就可以在Lambda语法中省去标注参数类型。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 当仅有一个参数时，参数两边的括号可以省略</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> greenApples <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>inventory<span class="token punctuation">,</span> a <span class="token operator">-&gt;</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a1<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a2<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>有时候显式写出类型更易读，有时候去掉它们更易读。</p></div> <h2 id="_3-5-使用局部变量"><a href="#_3-5-使用局部变量" class="header-anchor">#</a> 3.5 使用局部变量</h2> <p>Lambda表达式允许使用自由变量（不是主体里的参数，而是在外层作用域中定义的变量），被称为Lambda捕获。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> portNumber <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>
<span class="token class-name">Runnable</span> r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>portNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Lambda可以无限制的捕获实例变量和静态变量，但如果是局部变量，该变量必须显式声明为<code>final</code>，或事实上是<code>final</code>（隐式最终）。换句话说，Lambda表达式只能捕获指派给它们的局部变量一次。（捕获实例变量可以被看做捕获最终局部变量<code>this</code>。）</p> <p>为什么局部变量会有这些限制呢？</p> <p>第一，实例变量和局部变量背后的实现有一个关键的不同：实例变量存储在堆中，而局部变量则保存在栈上。</p> <p>Lambda线程可能会在分配该变量的线程回收变量后，去访问该变量，造成线程不安全。Lambda在访问自由局部变量时，实际上是在访问它的一个副本（仅限于所在线程），而不是原始变量。因此局部变量只能赋值一次，来确保它和副本没有区别。（实例变量保存在堆中，堆在线程之间是共享的。）</p> <p>第二，这一限制也是不鼓励使用改变外部变量的典型命令式编程模式（这种模式会阻碍很容易做到的并行处理）。</p> <h2 id="_3-6-方法引用"><a href="#_3-6-方法引用" class="header-anchor">#</a> 3.6 方法引用</h2> <h3 id="_3-6-1-什么是方法引用"><a href="#_3-6-1-什么是方法引用" class="header-anchor">#</a> 3.6.1 什么是方法引用</h3> <p>方法引用可以被看作仅仅特定调用方法的Lambda的一种快捷写法。</p> <p>它的基本思想是：如果一个Lambda代表的只是“直接调用这个方法”，那最好还是用名称来调用它，而不是去描述如何调用它。</p> <p>显示地指明方法的名称，代码的可读性会更好，感觉也更自然。</p> <h3 id="_3-6-2-基本语法"><a href="#_3-6-2-基本语法" class="header-anchor">#</a> 3.6.2 基本语法</h3> <p>目标引用放在分隔符<code>::</code>前，方法名称放在后面（方法名称不需要括号，因为没有实际调用这个方法）。</p> <p>方法引用可以看作针对仅仅涉及单一方法的Lambda的语法糖。</p> <div class="custom-block tip"><p class="custom-block-title">语法糖</p> <p>指计算机语言中添加的某种语法，这种语法对语言的功能并没有影响，但是更方便程序员使用。通常来说使用语法糖能够增加程序的可读性，从而减少程序代码出错的机会。</p></div> <table><thead><tr><th>Lambda</th> <th>等效的方法引用</th></tr></thead> <tbody><tr><td>(Apple a) -&gt; a.getWeight()</td> <td>Apple::getWeight</td></tr> <tr><td>() -&gt; Thread.currentThread().dumpStack()</td> <td>Thread.currentThread()::dumpStack</td></tr> <tr><td>(str, i) -&gt; str.substring(i)</td> <td>String::substring</td></tr> <tr><td>(String s) -&gt; System.out.println(s)</td> <td>System.out::println</td></tr></tbody></table> <h3 id="_3-6-3-方法引用的分类"><a href="#_3-6-3-方法引用的分类" class="header-anchor">#</a> 3.6.3 方法引用的分类</h3> <p>方法引用主要有几类：</p> <ul><li><p>指向静态方法的方法引用</p></li> <li><p>指向任意类型实例方法的方法引用（你在引用一个对象的方法，而这个对象本身是Lambda的一个参数）</p></li> <li><p>指向现有对象的实例方法的方法引用（在Lambda中调用一个已经存在的外部对象中的方法）</p></li> <li><p>特殊形式：构造函数、数组构造函数、父类调用</p></li></ul> <p><img src="/assets/img/SJIA-003-02.e1f5d651.jpg" alt=""></p> <h3 id="_3-6-4-构造函数引用"><a href="#_3-6-4-构造函数引用" class="header-anchor">#</a> 3.6.4 构造函数引用</h3> <p>对于一个现有构造函数，可以利用它的名称和关键字<code>new</code>来创建它的一个引用：<code>ClassName::new</code>。</p> <p>无参的构造函数适合<code>Supplier</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> c1 <span class="token operator">=</span> <span class="token class-name">Apple</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span>
<span class="token class-name">Apple</span> a1 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等价于：</span>
<span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> c1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Apple</span> a1 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>有一个参数的构造函数适合<code>Function</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> c2 <span class="token operator">=</span> <span class="token class-name">Apple</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span>
<span class="token class-name">Apple</span> a2 <span class="token operator">=</span> c2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等价于：</span>
<span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> c2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> weight<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span>weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Apple</span> a2 <span class="token operator">=</span> c2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_3-7-综合实例"><a href="#_3-7-综合实例" class="header-anchor">#</a> 3.7 综合实例</h2> <p>再一次来关注给Apple排序的代码的改造过程：</p> <h3 id="_3-7-1-传递代码"><a href="#_3-7-1-传递代码" class="header-anchor">#</a> 3.7.1 传递代码</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppleComparator</span> <span class="token keyword">implements</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Apple</span> a1<span class="token punctuation">,</span> <span class="token class-name">Apple</span> a2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a1<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a2<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

inventory<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AppleComparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-7-2-使用匿名类"><a href="#_3-7-2-使用匿名类" class="header-anchor">#</a> 3.7.2 使用匿名类</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>inventory<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Apple</span> a1<span class="token punctuation">,</span> <span class="token class-name">Apple</span> a2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a1<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a2<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-7-3-使用lambda表达式"><a href="#_3-7-3-使用lambda表达式" class="header-anchor">#</a> 3.7.3 使用Lambda表达式</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>inventory<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Apple</span> a1<span class="token punctuation">,</span> <span class="token class-name">Apple</span> a2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a1<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a2<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 由于Java编译器可以通过上下文来推断Lambda表达式参数类型，因此可以继续简化：</span>
inventory<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a1<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a2<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>Comparator</code>具有一个叫做<code>comparing</code>的静态辅助方法，接受一个<code>Function</code>来提取Comparable键值，并生成一个<code>Comparator</code>对象：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Apple</span> a<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>代码可以进一步紧凑一些：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span>comparing<span class="token punctuation">;</span>

inventory<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Apple</span> a<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-7-4-使用方法引用"><a href="#_3-7-4-使用方法引用" class="header-anchor">#</a> 3.7.4 使用方法引用</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span>comparing<span class="token punctuation">;</span>

inventory<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">Apple</span><span class="token operator">::</span><span class="token function">getWeight</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_3-8-复合lambda表达式的方法"><a href="#_3-8-复合lambda表达式的方法" class="header-anchor">#</a> 3.8 复合Lambda表达式的方法</h2> <h3 id="_3-8-1-比较器复合"><a href="#_3-8-1-比较器复合" class="header-anchor">#</a> 3.8.1 比较器复合</h3> <p>Comparator接口提供以下默认方法：</p> <ul><li><code>reversed</code>：使给定的比较器逆序。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>inventory<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">Apple</span><span class="token operator">::</span><span class="token function">getWeight</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>thenComparing</code>：接受一个函数作为参数，如果两个对象用第一个Comparator比较之后是一样的，就用第二个Comparator继续比较。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>inventory<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">Apple</span><span class="token operator">::</span><span class="token function">getWeight</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenComparing</span><span class="token punctuation">(</span><span class="token class-name">Apple</span><span class="token operator">::</span><span class="token function">getCountry</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-8-2-谓词复合"><a href="#_3-8-2-谓词复合" class="header-anchor">#</a> 3.8.2 谓词复合</h3> <p>Predicate接口包括三个方法：</p> <ul><li><code>negate</code>：产生现有Predicate的非</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> notRedApple <span class="token operator">=</span> redApple<span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>and</code>：链接两个谓词来生成另一个Predicate，逻辑且</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> redAndHeavyApple <span class="token operator">=</span> redApple<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>a <span class="token operator">-&gt;</span> a<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>or</code>：链接两个谓词来生成另一个Predicate，逻辑或</li></ul> <div class="custom-block warning"><p class="custom-block-title">优先级</p> <p><code>and</code>和<code>or</code>方法是按照在表达式链中的位置，从左向右确定优先级的，如<code>a.or(b).and(c)</code>可以看作<code>(a || b) &amp;&amp; c</code>。</p></div> <h3 id="_3-8-3-函数复合"><a href="#_3-8-3-函数复合" class="header-anchor">#</a> 3.8.3 函数复合</h3> <p>Function接口提供以下默认方法：</p> <ul><li><p><code>andThen</code>：先对输入应用一个给定的函数，再对输出应用另一个函数。</p></li> <li><p><code>compose</code>：先把给定的函数用作compose的参数里面给的那个函数，然后再把函数本身用于结果。</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span> x <span class="token operator">-&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> g <span class="token operator">=</span> x <span class="token operator">-&gt;</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">// 数学上相当于g(f(x))</span>
<span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> h1 <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">andThen</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回4</span>
<span class="token keyword">int</span> result1 <span class="token operator">=</span> h1<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 数学上相当于f(g(x))</span>
<span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> h2 <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回3</span>
<span class="token keyword">int</span> result2 <span class="token operator">=</span> h2<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>通过复合各种工具方法，可以用来创建转型流水线：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> addHeader <span class="token operator">=</span> <span class="token class-name">Letter</span><span class="token operator">::</span><span class="token function">addHeader</span><span class="token punctuation">;</span>
<span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> transformationPipeline <span class="token operator">=</span> addHeader<span class="token punctuation">.</span><span class="token function">andThen</span><span class="token punctuation">(</span><span class="token class-name">Letter</span><span class="token operator">::</span><span class="token function">checkSpelling</span><span class="token punctuation">)</span>
                                                           <span class="token punctuation">.</span><span class="token function">andThen</span><span class="token punctuation">(</span><span class="token class-name">Letter</span><span class="token operator">::</span><span class="token function">addFooter</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/special/java8_in_action/SJIA-002-behavior_parameterization.html" class="prev">
        2 通过行为参数化传递代码
      </a></span> <span class="next"><a href="/special/java8_in_action/SJIA-004-stream.html">
        4 引入流
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cb1c172b.js" defer></script><script src="/assets/js/2.167078e5.js" defer></script><script src="/assets/js/11.037eebc3.js" defer></script><script src="/assets/js/7.9c9ec0c0.js" defer></script>
  </body>
</html>
