<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5 使用流 | 熙宁的笔记</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="熙宁的笔记">
    <link rel="preload" href="/assets/css/0.styles.a214eddf.css" as="style"><link rel="preload" href="/assets/js/app.7ea158cc.js" as="script"><link rel="preload" href="/assets/js/2.167078e5.js" as="script"><link rel="preload" href="/assets/js/21.56908442.js" as="script"><link rel="preload" href="/assets/js/7.9c9ec0c0.js" as="script"><link rel="prefetch" href="/assets/js/10.a1772af3.js"><link rel="prefetch" href="/assets/js/11.1e675497.js"><link rel="prefetch" href="/assets/js/12.79bef4f7.js"><link rel="prefetch" href="/assets/js/13.6e9ad29d.js"><link rel="prefetch" href="/assets/js/14.7c41145a.js"><link rel="prefetch" href="/assets/js/15.fd904f12.js"><link rel="prefetch" href="/assets/js/16.059f8460.js"><link rel="prefetch" href="/assets/js/17.f056884e.js"><link rel="prefetch" href="/assets/js/18.d2d48b45.js"><link rel="prefetch" href="/assets/js/19.d7dae1a8.js"><link rel="prefetch" href="/assets/js/20.9da1840e.js"><link rel="prefetch" href="/assets/js/22.b8756be9.js"><link rel="prefetch" href="/assets/js/23.dd40b66d.js"><link rel="prefetch" href="/assets/js/24.9c20d5ab.js"><link rel="prefetch" href="/assets/js/25.d4c3be91.js"><link rel="prefetch" href="/assets/js/26.7f1a9bfe.js"><link rel="prefetch" href="/assets/js/27.e1735a18.js"><link rel="prefetch" href="/assets/js/28.2dc573d4.js"><link rel="prefetch" href="/assets/js/29.c6a0adcd.js"><link rel="prefetch" href="/assets/js/3.01a6a1b4.js"><link rel="prefetch" href="/assets/js/30.328e32f5.js"><link rel="prefetch" href="/assets/js/31.19020bf9.js"><link rel="prefetch" href="/assets/js/32.fc3853f5.js"><link rel="prefetch" href="/assets/js/33.65a7c4ae.js"><link rel="prefetch" href="/assets/js/34.74edf802.js"><link rel="prefetch" href="/assets/js/35.6e623b09.js"><link rel="prefetch" href="/assets/js/36.5e0c3a84.js"><link rel="prefetch" href="/assets/js/37.9b23ded0.js"><link rel="prefetch" href="/assets/js/38.ecb8852f.js"><link rel="prefetch" href="/assets/js/39.5cced95f.js"><link rel="prefetch" href="/assets/js/4.0fdf8adc.js"><link rel="prefetch" href="/assets/js/40.9b689566.js"><link rel="prefetch" href="/assets/js/41.e0947889.js"><link rel="prefetch" href="/assets/js/42.20e95b2f.js"><link rel="prefetch" href="/assets/js/5.ef0f248a.js"><link rel="prefetch" href="/assets/js/6.2622a0f7.js"><link rel="prefetch" href="/assets/js/8.b1d96fa7.js"><link rel="prefetch" href="/assets/js/9.a220f369.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a214eddf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo128.png" alt="熙宁的笔记" class="logo"> <span class="site-name can-hide">熙宁的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语法区" class="dropdown-title"><span class="title">语法区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ★ 数据库 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/devlang/db/oracle/grammar/DDO-G01-start_with.html" class="nav-link">
  Oracle
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="扫盲区" class="dropdown-title"><span class="title">扫盲区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/concept/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/concept/network/" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实践区" class="dropdown-title"><span class="title">实践区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ★ 综合复盘 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/project/EP-001-high_concurrency.html" class="nav-link">
  某高并发互联网项目
</a></li></ul></li><li class="dropdown-item"><h4>
          ★ 数据库 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/db/oracle/basic/EDO-B01-exp_empty.html" class="nav-link">
  Oracle
</a></li></ul></li><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/css/solution/EC-S01-collapse_chrome.html" class="nav-link">
  CSS
</a></li></ul></li><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/other/" class="nav-link">
  其它
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专项区" class="dropdown-title"><span class="title">专项区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/special/java8_in_action/SJIA-001-why_java8.html" class="nav-link">
  Java 8 实战
</a></li><li class="dropdown-item"><!----> <a href="/special/effective_java/SEJ-001-create_destroy_objects.html" class="nav-link">
  Effective Java 第2版
</a></li></ul></div></div><div class="nav-item"><a href="/readingnotes/" class="nav-link">
  阅读区
</a></div><div class="nav-item"><a href="/wordlist/" class="nav-link">
  单词表
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语法区" class="dropdown-title"><span class="title">语法区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ★ 数据库 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/devlang/db/oracle/grammar/DDO-G01-start_with.html" class="nav-link">
  Oracle
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="扫盲区" class="dropdown-title"><span class="title">扫盲区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/concept/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/concept/network/" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实践区" class="dropdown-title"><span class="title">实践区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ★ 综合复盘 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/project/EP-001-high_concurrency.html" class="nav-link">
  某高并发互联网项目
</a></li></ul></li><li class="dropdown-item"><h4>
          ★ 数据库 ★
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/db/oracle/basic/EDO-B01-exp_empty.html" class="nav-link">
  Oracle
</a></li></ul></li><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/css/solution/EC-S01-collapse_chrome.html" class="nav-link">
  CSS
</a></li></ul></li><li class="dropdown-item"><h4>
          
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/experience/other/" class="nav-link">
  其它
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专项区" class="dropdown-title"><span class="title">专项区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/special/java8_in_action/SJIA-001-why_java8.html" class="nav-link">
  Java 8 实战
</a></li><li class="dropdown-item"><!----> <a href="/special/effective_java/SEJ-001-create_destroy_objects.html" class="nav-link">
  Effective Java 第2版
</a></li></ul></div></div><div class="nav-item"><a href="/readingnotes/" class="nav-link">
  阅读区
</a></div><div class="nav-item"><a href="/wordlist/" class="nav-link">
  单词表
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java 8 实战</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/special/java8_in_action/SJIA-001-why_java8.html" class="sidebar-link">1 为什么要关心Java 8</a></li><li><a href="/special/java8_in_action/SJIA-002-behavior_parameterization.html" class="sidebar-link">2 通过行为参数化传递代码</a></li><li><a href="/special/java8_in_action/SJIA-003-lambda.html" class="sidebar-link">3 Lambda表达式</a></li><li><a href="/special/java8_in_action/SJIA-004-stream.html" class="sidebar-link">4 引入流</a></li><li><a href="/special/java8_in_action/SJIA-005-use_stream.html" class="active sidebar-link">5 使用流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-1-筛选和切片" class="sidebar-link">5.1 筛选和切片</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-2-映射" class="sidebar-link">5.2 映射</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-2-1-对流中每一个元素应用函数" class="sidebar-link">5.2.1 对流中每一个元素应用函数</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-2-2-流的扁平化" class="sidebar-link">5.2.2 流的扁平化</a></li></ul></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-3-查找和匹配" class="sidebar-link">5.3 查找和匹配</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-3-1-匹配" class="sidebar-link">5.3.1 匹配</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-3-2-查找" class="sidebar-link">5.3.2 查找</a></li></ul></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-4-归约" class="sidebar-link">5.4 归约</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-4-1-reduce" class="sidebar-link">5.4.1 reduce</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-4-2-归约的优势" class="sidebar-link">5.4.2 归约的优势</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-4-3-无状态与有状态" class="sidebar-link">5.4.3 无状态与有状态</a></li></ul></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-5-总结与练习" class="sidebar-link">5.5 总结与练习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-5-1-操作总结" class="sidebar-link">5.5.1 操作总结</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-5-2-练习" class="sidebar-link">5.5.2 练习</a></li></ul></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-6-数值流" class="sidebar-link">5.6 数值流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-6-1-原始类型流特化" class="sidebar-link">5.6.1 原始类型流特化</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-6-2-数值范围" class="sidebar-link">5.6.2 数值范围</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-6-3-数值流应用：勾股数" class="sidebar-link">5.6.3 数值流应用：勾股数</a></li></ul></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-7-构建流" class="sidebar-link">5.7 构建流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-7-1-由值创建流" class="sidebar-link">5.7.1 由值创建流</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-7-2-由数组创建流" class="sidebar-link">5.7.2 由数组创建流</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-7-3-由文件生成流" class="sidebar-link">5.7.3 由文件生成流</a></li><li class="sidebar-sub-header"><a href="/special/java8_in_action/SJIA-005-use_stream.html#_5-7-4-由函数生成流：创建无限流" class="sidebar-link">5.7.4 由函数生成流：创建无限流</a></li></ul></li></ul></li><li><a href="/special/java8_in_action/SJIA-006-collectors.html" class="sidebar-link">6 用流收集数据</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_5-使用流"><a href="#_5-使用流" class="header-anchor">#</a> 5 使用流</h1> <div class="seal-box" data-v-77f8f7a4><div data-v-77f8f7a4><!----> <div class="head" data-v-77f8f7a4>读书笔记</div> <div data-v-77f8f7a4><span class="ico ico-book" data-v-77f8f7a4>  书   名  ： Java 8 实战</span></div> <div data-v-77f8f7a4><span class="ico ico-author" data-v-77f8f7a4>  作   者  ： （英）Raoul-Gabriel Urma（意）Mario Fusco（英）Alan Myscroft</span></div> <div data-v-77f8f7a4><span class="ico ico-translator" data-v-77f8f7a4>  译   者  ： 陆明刚，劳佳</span></div> <div data-v-77f8f7a4><span class="ico ico-publisher" data-v-77f8f7a4> 出 版 社 ： 人民邮电出版社</span></div> <div data-v-77f8f7a4><span class="ico ico-calendar" data-v-77f8f7a4>出版时间： 2016.04</span></div> <div data-v-77f8f7a4><span class="ico ico-date" data-v-77f8f7a4>创建时间：</span> <span class="info" data-v-77f8f7a4>2021.12.12</span></div> <div data-v-77f8f7a4><span class="ico ico-refresh" data-v-77f8f7a4>最后更新：</span> <span class="info" data-v-77f8f7a4>2022.01.01</span></div> <!----> <!----> <!----> <div class="foot" data-v-77f8f7a4>竢实扬华 · 自强不息</div></div></div> <h2 id="_5-1-筛选和切片"><a href="#_5-1-筛选和切片" class="header-anchor">#</a> 5.1 筛选和切片</h2> <table><thead><tr><th>操作</th> <th>类型</th> <th>入参</th> <th>功能</th></tr></thead> <tbody><tr><td>filter</td> <td>中间</td> <td>Predicate&lt;T&gt;</td> <td>返回一个包含所有符合谓词的元素的流。</td></tr> <tr><td>distinct</td> <td>中间</td> <td></td> <td>返回一个元素各异的流。（根据流所生成元素的hashCode和equals方法实现）</td></tr> <tr><td>limit</td> <td>中间</td> <td>long</td> <td>返回一个不超过给定长度的流。</td></tr> <tr><td>skip</td> <td>中间</td> <td>long</td> <td>返回一个扔掉了前n个元素的流。如果流中元素不足n个，则返回一个空流。（与limit是互补的。）</td></tr></tbody></table> <h2 id="_5-2-映射"><a href="#_5-2-映射" class="header-anchor">#</a> 5.2 映射</h2> <h3 id="_5-2-1-对流中每一个元素应用函数"><a href="#_5-2-1-对流中每一个元素应用函数" class="header-anchor">#</a> 5.2.1 对流中每一个元素应用函数</h3> <p><code>map</code>方法接受一个函数作为参数，这个函数会被应用到每个元素上，并将其映射成一个新的元素。</p> <h3 id="_5-2-2-流的扁平化"><a href="#_5-2-2-流的扁平化" class="header-anchor">#</a> 5.2.2 流的扁平化</h3> <p><code>flatMap</code>方法把一个流中的每个值都换成另一个流，然后把所有的流连接起来成为一个流（即扁平化为一个流）。</p> <p>例子1：对于一张单词表，返回一个列表，列出所有单词中各不相同的字符。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> words <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> words<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>w <span class="token operator">-&gt;</span> w<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                         <span class="token comment">// Arrays.stream()方法接受一个数组并产生一个流</span>
                         <span class="token comment">// flatMap实现各个数组并不是分别映射成一个流，而是映射成流的内容，即扁平化为单个流</span>
                         <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token operator">::</span><span class="token function">stream</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="/assets/img/SJIA-005-01.01b4c502.jpg" alt=""></p> <p>例子2：给定列表[1, 2, 3]和列表[3, 4]，返回所有的数对（即[(1,3), (1,4), (2,3), (2,4), (3,3), (3,4)]），并根据总和能被3整除进行过滤（即[(2,4), (3,3)]）。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> numbers1 <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> numbers2 <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> pairs <span class="token operator">=</span> numbers1<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> numbers2<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>j <span class="token operator">-&gt;</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                                                  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>j <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>i<span class="token punctuation">,</span> j<span class="token punctuation">}</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_5-3-查找和匹配"><a href="#_5-3-查找和匹配" class="header-anchor">#</a> 5.3 查找和匹配</h2> <h3 id="_5-3-1-匹配"><a href="#_5-3-1-匹配" class="header-anchor">#</a> 5.3.1 匹配</h3> <table><thead><tr><th>操作</th> <th>类型</th> <th>入参</th> <th>功能</th></tr></thead> <tbody><tr><td>anyMatch</td> <td>终端</td> <td>Predicate&lt;T&gt;</td> <td>判断流中是否有一个元素能匹配给定的谓词。</td></tr> <tr><td>allMatch</td> <td>终端</td> <td>Predicate&lt;T&gt;</td> <td>判断流中的元素是否都能匹配给定的谓词。</td></tr> <tr><td>noneMatch</td> <td>终端</td> <td>Predicate&lt;T&gt;</td> <td>判断流中的元素是否都不能匹配给定的谓词。</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">短路求值</p> <p>有些操作不需要处理整个流就能得到结果。</p> <p>比如<code>anyMatch</code>、<code>allMatch</code>、<code>noneMatch</code>、<code>findFirst</code>、<code>findAny</code>，只要找到一个元素，就可以有结果了。</p> <p><code>limit</code>也是一个短路操作，它只需要创建一个给定大小的流，而用不着处理流中的所有元素。（它可以将无限流变成有限流。）</p></div> <h3 id="_5-3-2-查找"><a href="#_5-3-2-查找" class="header-anchor">#</a> 5.3.2 查找</h3> <table><thead><tr><th>操作</th> <th>类型</th> <th>功能</th></tr></thead> <tbody><tr><td>findAny</td> <td>终端</td> <td>返回当前流中的任意元素。</td></tr> <tr><td>findFirst</td> <td>终端</td> <td>返回当前流中的第一个元素。（由List或排序好的数据列生成的流，有一个出现顺序来指定流中项目出现的逻辑顺序。）</td></tr></tbody></table> <blockquote><p>如果不关心返回的元素是哪一个，则使用<code>findAny</code>，它在使用并行流时限制较少。</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dish</span><span class="token punctuation">&gt;</span></span> dish <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">Dish</span><span class="token operator">::</span><span class="token function">isVegetarian</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">findAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">初识 Optional&lt;T&gt;</p> <p><code>java.util.Optional</code>是一个容器类，代表着一个值存在或不存在。 利用<code>Optional</code>，可以避免和null检查相关的bug。</p> <p><code>Optional</code>的一些方法：</p> <ul><li><p><code>isPresent()</code>将在<code>Optional</code>包含值的时候返回true，否则返回false。</p></li> <li><p><code>ifPresent(Consumer&lt;T&gt; block)</code>会在值存在的时候执行给定的代码块。</p></li> <li><p><code>T get()</code>会在值存在时返回值，否则抛出一个<code>NoSuchElement</code>异常。</p></li> <li><p><code>T orElse(T other)</code>会在值存在时返回值，否则返回一个默认值。</p></li></ul></div> <h2 id="_5-4-归约"><a href="#_5-4-归约" class="header-anchor">#</a> 5.4 归约</h2> <h3 id="_5-4-1-reduce"><a href="#_5-4-1-reduce" class="header-anchor">#</a> 5.4.1 reduce</h3> <p>归约操作：将流归约成一个值。</p> <p><code>reduce</code>接受两个参数：</p> <ul><li><p>一个初始值</p></li> <li><p>一个Lambda来把两个流元素结合起来并产生一个新值</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 求和</span>
<span class="token keyword">int</span> sum <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用Java 8中新增的静态方法替代Lambda</span>
<span class="token keyword">int</span> sum <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>reduce</code>还有一个重载的变体，它不接受初始值，它会返回一个<code>Optional</code>对象，以表明结果可能不存在。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> sum <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> max <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> min <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">map-reduce 模式</p> <p><code>map</code>和<code>reduce</code>的连接通常称为<code>map-reduce</code>模式，因Google用它来进行网络搜索而出名，它很容易并行化。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 使用map-reduce求元素个数</span>
<span class="token keyword">int</span> count <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>d <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <h3 id="_5-4-2-归约的优势"><a href="#_5-4-2-归约的优势" class="header-anchor">#</a> 5.4.2 归约的优势</h3> <p>使用<code>reduce</code>的好处在于，迭代被内部迭代抽象化了，这让内部实现得以选择并行执行<code>reduce</code>操作。</p> <p>并行操作时，只需将<code>stream()</code>换成<code>parallelStream()</code>，别的代码不用修改。</p> <blockquote><p>并行执行需要付出一定代价，传递给<code>reduce</code>的Lambda不能更改状态，而且操作必须可按任意顺序执行。</p></blockquote> <h3 id="_5-4-3-无状态与有状态"><a href="#_5-4-3-无状态与有状态" class="header-anchor">#</a> 5.4.3 无状态与有状态</h3> <p>诸如<code>map</code>、<code>filter</code>等操作，它们没有内部状态，即操作是无状态的。</p> <p>诸如<code>reduce</code>、求和、取最大值、<code>sort</code>、<code>distinct</code>等操作，需要内部状态来积累结果，这些操作是有状态的。</p> <p>有状态的这些操作中，诸如<code>reduce</code>、求和、取最大值，不管流中有多少元素要处理，内部只需要固定数量的存储，这称作有界的。</p> <p>诸如<code>sort</code>、<code>distinct</code>等操作，它们对存储的要求是无界的，若流比较大或是无限的，就很可能出问题。</p> <h2 id="_5-5-总结与练习"><a href="#_5-5-总结与练习" class="header-anchor">#</a> 5.5 总结与练习</h2> <h3 id="_5-5-1-操作总结"><a href="#_5-5-1-操作总结" class="header-anchor">#</a> 5.5.1 操作总结</h3> <table><thead><tr><th>操作</th> <th>类型</th> <th>返回类型</th> <th>使用的类型/函数式接口</th> <th>函数描述符</th></tr></thead> <tbody><tr><td>filter</td> <td>中间</td> <td>Stream&lt;T&gt;</td> <td>Predicate&lt;T&gt;</td> <td>T -&gt; boolean</td></tr> <tr><td>distinct</td> <td>中间（有状态-无界）</td> <td>Stream&lt;T&gt;</td> <td></td> <td></td></tr> <tr><td>skip</td> <td>中间（有状态-有界）</td> <td>Stream&lt;T&gt;</td> <td>long</td> <td></td></tr> <tr><td>limit</td> <td>中间（有状态-有界）</td> <td>Stream&lt;T&gt;</td> <td>long</td> <td></td></tr> <tr><td>map</td> <td>中间</td> <td>Stream&lt;R&gt;</td> <td>Function&lt;T, R&gt;</td> <td>T -&gt; R</td></tr> <tr><td>flatMap</td> <td>中间</td> <td>Stream&lt;R&gt;</td> <td>Function&lt;T, Stream&lt;R&gt;&gt;</td> <td>T -&gt; Stream&lt;R&gt;</td></tr> <tr><td>sorted</td> <td>中间（有状态-无界）</td> <td>Stream&lt;T&gt;</td> <td>Comparator&lt;T&gt;</td> <td>(T, T) -&gt; int</td></tr> <tr><td>anyMatch</td> <td>终端</td> <td>boolean</td> <td>Predicate&lt;T&gt;</td> <td>T -&gt; boolean</td></tr> <tr><td>noneMatch</td> <td>终端</td> <td>boolean</td> <td>Predicate&lt;T&gt;</td> <td>T -&gt; boolean</td></tr> <tr><td>allMatch</td> <td>终端</td> <td>boolean</td> <td>Predicate&lt;T&gt;</td> <td>T -&gt; boolean</td></tr> <tr><td>findAny</td> <td>终端</td> <td>Optional&lt;T&gt;</td> <td></td> <td></td></tr> <tr><td>findFirst</td> <td>终端</td> <td>Optional&lt;T&gt;</td> <td></td> <td></td></tr> <tr><td>forEach</td> <td>终端</td> <td>void</td> <td>Consumer&lt;T&gt;</td> <td>T -&gt; void</td></tr> <tr><td>collect</td> <td>终端</td> <td>R</td> <td>Collector&lt;T, A, R&gt;</td> <td></td></tr> <tr><td>reduce</td> <td>终端（有状态-有界）</td> <td>Optional&lt;T&gt;</td> <td>BinaryOperator&lt;T&gt;</td> <td>(T, T) -&gt; T</td></tr> <tr><td>count</td> <td>终端</td> <td>long</td> <td></td> <td></td></tr></tbody></table> <h3 id="_5-5-2-练习"><a href="#_5-5-2-练习" class="header-anchor">#</a> 5.5.2 练习</h3> <p>领域模型：交易员（Trader）、交易（Transaction）</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Trader</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Trader</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> city<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> city<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> name<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> city<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;Trader [name=&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;, city=&quot;</span> <span class="token operator">+</span> city <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Trader</span> trader<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> year<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> value<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token class-name">Trader</span> trader<span class="token punctuation">,</span> <span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>trader <span class="token operator">=</span> trader<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Trader</span> <span class="token function">getTrader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> trader<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> year<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> value<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;Transaction [trader=&quot;</span> <span class="token operator">+</span> trader <span class="token operator">+</span> <span class="token string">&quot;, year=&quot;</span> <span class="token operator">+</span> year <span class="token operator">+</span> <span class="token string">&quot;, value=&quot;</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><blockquote><p>交易员在哪些不同的城市工作过</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cities <span class="token operator">=</span> transactions<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				                  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">.</span><span class="token function">getTrader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				                  <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				                  <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 可以用toSet()代替distinct()</span>
<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cities <span class="token operator">=</span> transactions<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				                 <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">.</span><span class="token function">getTrader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				                 <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>将所有交易员的姓名排序后，连接返回一个字符串</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> names <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">.</span><span class="token function">getTrader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token comment">// 所有字符串反复连接，每次迭代建立新的String对象，效率不高</span>
                          <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 优化方法：joining()，内部会使用StringBuilder</span>
<span class="token class-name">String</span> names <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">.</span><span class="token function">getTrader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>找到最小额度的交易</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Transaction</span><span class="token punctuation">&gt;</span></span> min <span class="token operator">=</span> transactions<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				                        <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> t1<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> t2<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> t1 <span class="token operator">:</span> t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用流的min方法可以做的更好</span>
<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Transaction</span><span class="token punctuation">&gt;</span></span> min <span class="token operator">=</span> transactions<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				                        <span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">Transaction</span><span class="token operator">::</span><span class="token function">getValue</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_5-6-数值流"><a href="#_5-6-数值流" class="header-anchor">#</a> 5.6 数值流</h2> <h3 id="_5-6-1-原始类型流特化"><a href="#_5-6-1-原始类型流特化" class="header-anchor">#</a> 5.6.1 原始类型流特化</h3> <p>使用<code>reduce</code>方法可以计算流中元素的总和，如：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> calories <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Dish</span><span class="token operator">::</span><span class="token function">getCalories</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面这段代码的问题在于，暗含了装箱、拆箱的成本。</p> <p>Stream API提供原始类型流特化，专门支持处理数值流的方法：<code>IntStream</code>、<code>DoubleStream</code>和<code>LongStream</code>，分别将流中的元素特化为int、double和long。</p> <p>每个原始类型特化流接口都带来了常用数值归约的新方法，如<code>sum</code>、<code>max</code>、<code>average</code>等，还有转换回对象流的方法。</p> <p>特化的原因并不在于流的复杂性，而是装箱造成的复杂性——即类似int和Integer之间的效率差异。</p> <h4 id="_5-6-1-1-映射到数值流"><a href="#_5-6-1-1-映射到数值流" class="header-anchor">#</a> 5.6.1.1 映射到数值流</h4> <p><code>mapToInt</code>、<code>mapToDouble</code>、<code>mapToLong</code>这些方法，与<code>map</code>方法的工作方式一样，但它们返回的是一个特化流，而不是Stream&lt;T&gt;。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> calories <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                   <span class="token comment">// 注意返回的是IntStream，而不是Stream&lt;T&gt;</span>
                   <span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">Dish</span><span class="token operator">::</span><span class="token function">getCalories</span><span class="token punctuation">)</span>
                   <span class="token comment">// 如果流是空的，sum默认返回0</span>
                   <span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5-6-1-2-转换回对象流"><a href="#_5-6-1-2-转换回对象流" class="header-anchor">#</a> 5.6.1.2 转换回对象流</h4> <p>要把原始流转换成一般流，可以使用<code>boxed</code>方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">IntStream</span> intStream <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">Dish</span><span class="token operator">::</span><span class="token function">getCalories</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> intStream<span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>需要将数值范围装箱成为一个一般流时，<code>boxed</code>尤其有用。</p> <h4 id="_5-6-1-3-默认值optional"><a href="#_5-6-1-3-默认值optional" class="header-anchor">#</a> 5.6.1.3 默认值Optional</h4> <p>对于三种原始流特化，分别有一个<code>Optional</code>原始类型特化版本：<code>OptionalInt</code>、<code>OptionalDouble</code>和<code>OptionalLong</code>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">OptionalInt</span> maxCalories <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">Dish</span><span class="token operator">::</span><span class="token function">getCalories</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 定义一个默认值</span>
<span class="token keyword">int</span> max <span class="token operator">=</span> maxCalories<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_5-6-2-数值范围"><a href="#_5-6-2-数值范围" class="header-anchor">#</a> 5.6.2 数值范围</h3> <p>Java 8引用了两个可以用于<code>IntStream</code>和<code>LongStream</code>的静态方法，用于生成数字范围：<code>range</code>、<code>rangeClosed</code>。</p> <p>这两个方法都是第一个参数接受起始值，第二个参数接受结束值，但<code>range</code>不包含结束值，而<code>rangeClosed</code>包含结束值。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">IntStream</span> evenNumbers <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
                                 <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">-&gt;</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>evenNumbers<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_5-6-3-数值流应用：勾股数"><a href="#_5-6-3-数值流应用：勾股数" class="header-anchor">#</a> 5.6.3 数值流应用：勾股数</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> pythagoreanTriples <span class="token operator">=</span> 
    <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>a <span class="token operator">-&gt;</span> 
                 <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>b <span class="token operator">-&gt;</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> a <span class="token operator">+</span> b <span class="token operator">*</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span>b <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> a <span class="token operator">+</span> b <span class="token operator">*</span> b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                          <span class="token comment">// 上面一行代码也可以用下面两行替代</span>
                          <span class="token comment">// .boxed()</span>
                          <span class="token comment">// .map(b -&gt; new int[]{a, b, (int) Math.sqrt(a * a + b * b)})</span>
             <span class="token punctuation">)</span><span class="token punctuation">;</span>

pythagoreanTriples<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>上述代码会求两次平方根，可以进一步优化让代码更为紧凑：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> pythagoreanTriples <span class="token operator">=</span> 
    <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>a <span class="token operator">-&gt;</span> 
                 <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span>b <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> a <span class="token operator">+</span> b <span class="token operator">*</span> b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
             <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_5-7-构建流"><a href="#_5-7-构建流" class="header-anchor">#</a> 5.7 构建流</h2> <h3 id="_5-7-1-由值创建流"><a href="#_5-7-1-由值创建流" class="header-anchor">#</a> 5.7.1 由值创建流</h3> <p>静态方法<code>Stream.of</code>可以通过显示值创建一个流，它可以接受任意数量的参数。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>静态方法<code>Stream.empty</code>可以得到一个空流。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> emptyStream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5-7-2-由数组创建流"><a href="#_5-7-2-由数组创建流" class="header-anchor">#</a> 5.7.2 由数组创建流</h3> <p>静态方法<code>Arrays.stream</code>可以从数组创建一个流，它接受一个数组作为参数。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_5-7-3-由文件生成流"><a href="#_5-7-3-由文件生成流" class="header-anchor">#</a> 5.7.3 由文件生成流</h3> <p>Java中用于处理文件等I/O操作的NIO API已经可以更好的利用Stream API了，<code>java.nio.file.Files</code>中的很多静态方法都会返回一个流。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">long</span> uniqueWords <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lines <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;data.txt&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uniqueWords <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>line <span class="token operator">-&gt;</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_5-7-4-由函数生成流：创建无限流"><a href="#_5-7-4-由函数生成流：创建无限流" class="header-anchor">#</a> 5.7.4 由函数生成流：创建无限流</h3> <p>无限流不像从固定集合创建的流那样有固定的大小，它通过给定的函数按需创建值，可以无穷无尽地计算下去，所以必须使用<code>limit</code>操作来显式限制它的大小。</p> <h4 id="_5-7-4-1-iterate迭代"><a href="#_5-7-4-1-iterate迭代" class="header-anchor">#</a> 5.7.4.1 iterate迭代</h4> <p><code>Stream.iterate</code>接受一个初始值，还有一个依次应用在每个产生的新值上的Lambda（<code>UnaryOperator&lt;T&gt;</code>类型）。</p> <p>使用<code>iterate</code>实现斐波那契数列：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">itrate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> t <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_5-7-4-2-generate生成"><a href="#_5-7-4-2-generate生成" class="header-anchor">#</a> 5.7.4.2 generate生成</h4> <p><code>Stream.generate</code>接受一个<code>Supplier&lt;T&gt;</code>类型的Lambda提供新的值。</p> <p>比较如下两段代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">IntStream</span> ones <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IntStream</span> twos <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IntSupplier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>匿名类的方式有副作用，它可以通过字段定义状态，而状态又可以用<code>getAsInt</code>方法来修改，如果在并行代码中使用有状态的供应源，是不安全的，应该尽量避免使用。</p> <p>而Lambda是没有任何状态的，它没有匿名类的副作用。</p> <p>使用<code>generate</code>实现斐波那契数列（有状态、有副作用、应避免这种写法）：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">IntSupplier</span> fib <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntSupplier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> current <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> oldPrevious <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>previous<span class="token punctuation">;</span>
        <span class="token keyword">int</span> nextValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>previous <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>previous <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> nextValue<span class="token punctuation">;</span>
        <span class="token keyword">return</span> oldPrevious<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>fib<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>应该始终采用不变的（没有状态的）方法，以便并行处理流，并保持结果正确。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/special/java8_in_action/SJIA-004-stream.html" class="prev">
        4 引入流
      </a></span> <span class="next"><a href="/special/java8_in_action/SJIA-006-collectors.html">
        6 用流收集数据
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7ea158cc.js" defer></script><script src="/assets/js/2.167078e5.js" defer></script><script src="/assets/js/21.56908442.js" defer></script><script src="/assets/js/7.9c9ec0c0.js" defer></script>
  </body>
</html>
